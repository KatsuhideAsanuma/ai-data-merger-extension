# AI Data Merger Extension

複数ファイルをマージしてAI用の参照データを生成するVSCode拡張機能です。大規模言語モデル（LLM）への入力用データファイルを効率的に作成できます。

![Extension Icon](resources/icon.png)

## 概要

AI開発やプロンプトエンジニアリングでは、複数のファイルからコンテキスト情報を集めてAIに提供する必要があります。この拡張機能は、複数のファイルを選択し、整形された単一のMarkdownファイルに結合することで、AIへの効率的な情報提供をサポートします。またプロンプトの管理をマージ機能に統合し作成したプロンプトをマージファイルにも反映させることができます。

### 主な特徴

- **直感的なファイル選択**: エクスプローラーの右クリックメニューからファイルを追加
- **カテゴリ管理**: ファイルを「プロンプト出力」「設計書出力」「参照コード出力」などのカテゴリに分類
- **柔軟な順序管理**: サイドバーでファイル順序の変更・カテゴリ変更が可能
- **目次生成**: マージファイルには自動的に階層構造の目次が生成される
- **高度なプロンプト管理**: テンプレートベースのプロンプト作成と変数置換に対応
- **リアルタイム編集**: プロンプトとテンプレートのリアルタイム編集と自動保存機能
- **カスタマイズ可能**: 出力先パス、ファイル名、カテゴリなどをカスタマイズ可能
- **マージ履歴**: 過去のマージ操作を保存し、再実行可能
- **プロジェクト別マージリスト**: プロジェクト単位でよく使うマージリストを保存・再利用
- **プロンプトテンプレート**: 再利用可能なプロンプトテンプレートを作成・管理
- **変数置換機能**: テンプレート内の変数を簡単に置換してカスタムプロンプトを生成
- **プロンプトのマージ**: マージファイルにもプロンプトを反映させることができます

## インストール方法

### 方法1: VSCode Marketplaceからインストール

1. VSCodeの拡張機能タブを開く
2. 検索ボックスに「AI Data Merger」と入力
3. 「AI Data Merger Extension」を選択してインストール

### 方法2: VSIXファイルからインストール

1. リポジトリをクローン: `git clone https://github.com/katsuhideAsanuma/ai-data-merger-extension.git`
2. 依存パッケージをインストール: `npm install`
3. 拡張機能をパッケージ化: `npm run package`
4. 生成されたVSIXファイルをインストール:
   - VSCodeで `Ctrl+Shift+P` → 「Install from VSIX」を選択
   - または、コマンドラインで: `code --install-extension ai-data-merger-extension-0.1.0.vsix`

## 使用方法

### 基本的な使い方

1. **サイドバーアイコン**: VSCodeの左側のアクティビティバーで「AI Data Merger」アイコンをクリック
2. **ファイルの追加**: エクスプローラーでファイルを右クリックし、「Add to File Merge Queue」を選択
   - ファイルがカテゴリ選択ダイアログで指定したカテゴリに追加されます
3. **マージファイルの生成**: サイドバーの「Generate Merged File」ボタンをクリック
   - ファイル名を指定するダイアログが表示されます
   - 既定のファイル名またはカスタムファイル名を入力
4. **結果の確認**: 生成されたマージファイルが自動的に開きます

### プロンプト管理機能

新世代のプロンプト管理システムを搭載し、直感的な編集と自動保存機能を提供します。

#### テンプレートの作成と編集

1. **テンプレート作成**: サイドバーの「Prompts」タブで「Create Prompt Template」ボタンをクリック
   - テンプレート名とカテゴリを指定
   - 変数は `[[変数名]]` の形式で記述（例: `こんにちは、[[名前]]さん`）
   - **変更の自動保存**: 編集内容は自動的に保存され、変数が抽出されます

2. **テンプレート編集**: テンプレート項目の編集アイコンをクリック
   - 直接Markdownファイルとして編集可能
   - 保存時に変数が自動的に抽出・更新

#### 単純テキストプロンプトの管理

1. **プロンプト作成**: 「Create Simple Text Prompt」ボタンをクリック
   - プロンプト名とカテゴリを指定
   - エディタでプロンプト内容を編集
   - **リアルタイム保存**: 変更は自動的に保存されます

2. **テンプレートからの生成**: テンプレート項目の「Generate from Template」をクリック
   - 変数入力フォームが表示され、各変数の値を設定可能
   - 変数値を入力後、新しいプロンプトとして保存

#### インポート・エクスポート

1. **エクスポート**: 「Export Prompts」ボタンをクリック
   - JSON, マークダウン、テキスト形式でエクスポート可能
   - 全プロンプト、テンプレートのみ、単純テキストのみから選択可能

2. **インポート**: 「Import Prompts」ボタンをクリック
   - ファイル、クリップボード、エディタから選択可能
   - 重複プロンプトの処理方法を選択（上書き、リネーム、スキップ）

### ファイル管理機能

- **ファイルの順序変更**: サイドバーのファイル項目にある上下矢印ボタンで順序を変更
- **カテゴリの変更**: ファイル項目のフォルダアイコンをクリックしてカテゴリを変更
- **ファイルの削除**: ファイル項目のゴミ箱アイコンをクリックして削除
- **キューのクリア**: サイドバー上部の「Clear Merge Queue」ボタンでキューをクリア

### 履歴と再利用

- **マージ履歴**: サイドバーの「Merge History」タブで過去のマージ操作を確認
- **マージの再実行**: 履歴項目をクリックして過去のマージ設定を再実行
- **マージリストの保存**: よく使うマージ設定を「Add to Project Merge Lists」で保存
- **保存済みリストの読み込み**: 「Load Project Merge List」ボタンでプロジェクト内のマージリストを読み込み

## 設定オプション

VSCodeの設定（`settings.json`）で以下の項目をカスタマイズできます：

```json
{
  "aiDataMerger.outputPath": "./merged",      // マージファイルの出力先フォルダ
  "aiDataMerger.defaultFileName": "merged_data.md",  // デフォルトのファイル名
  "aiDataMerger.allowedFileTypes": [          // マージ可能なファイル形式
    "markdown", "plaintext", "javascript", "typescript", "json", "yaml",
    "python", "java", "cpp", "csharp", "go", "rust", "ruby", "php",
    "html", "css", "xml", "shellscript", "bat", "sql"
    // その他多数のファイル形式をサポート
  ],
  "aiDataMerger.showDataFileContent": false,  // JSONやYAMLファイルの全コード表示(falseの場合は構造のみ)
  "aiDataMerger.categories": [                // マージファイル内のカテゴリ一覧
    "プロンプト出力",
    "設計書出力", 
    "参照コード出力"
    // カスタムカテゴリを追加可能
  ],
  "aiDataMerger.promptsStoragePath": "./prompts", // プロンプト保存先ディレクトリ
  "aiDataMerger.promptCategories": [          // プロンプトカテゴリのデフォルト一覧
    "コード生成", "説明要求", "要約", "デバッグ", "一般"
  ],
  "aiDataMerger.maxTokenWarningThreshold": 4000, // トークン数警告しきい値
}
```

### カテゴリのカスタマイズ

カテゴリは、VSCodeの設定から簡単にカスタマイズできます：

1. **設定画面から変更**: 
   - VSCodeの設定画面（`Ctrl+,`）を開く
   - 「AI Data Merger」を検索
   - `aiDataMerger.categories` の配列を編集

2. **settings.jsonで直接編集**:
   - `settings.json`に以下を追加・編集
   ```json
   "aiDataMerger.categories": [
     "プロンプト出力",
     "設計書出力",
     "参照コード出力",
     "カスタムカテゴリ1",  // 独自のカテゴリを追加
     "カスタムカテゴリ2"
   ]
   ```

### プロンプトカテゴリのカスタマイズ

プロンプトカテゴリも同様に設定から変更できます：

```json
"aiDataMerger.promptCategories": [
  "コード生成",
  "説明要求",
  "要約",
  "デバッグ",
  "一般",
  "API呼び出し",  // 新しいカテゴリを追加
  "データ分析"
]
```

### データファイル表示の設定

JSONやYAMLなどのデータファイルの表示方法を設定できます：

- `aiDataMerger.showDataFileContent`: `false`（デフォルト）の場合、データファイルは構造のみ表示され、コード全体は表示されません。`true`に設定すると、データファイルも完全表示されます。

## 出力ファイル形式

生成されるマージファイルは以下の形式で構造化されます：

1. **メタデータセクション**: タイトル、タイムスタンプ、ファイル数などの情報
2. **目次**: すべてのカテゴリとファイルへのリンクを含む階層的な目次
3. **コンテンツ**: カテゴリごとにグループ化されたファイル内容
   - マークダウンファイル: インラインで内容を表示、見出しレベルを調整
   - コードファイル: 言語に応じた構文ハイライトを含むコードブロックで表示
   - ディレクトリ: ファイル一覧をコードブロックで表示

## プロジェクト構成

```
ai-data-merger-extension/
├── src/                    # ソースコード
│   ├── extension.ts        # 拡張機能のエントリーポイント
│   ├── components/         # 主要コンポーネント
│   │   ├── ConfigManager.ts    # 設定管理
│   │   ├── HistoryManager.ts   # 履歴管理
│   │   ├── MergeManager.ts     # マージ処理
│   │   ├── PromptManager.ts    # プロンプト管理
│   │   └── QueueManager.ts     # ファイルキュー管理
│   ├── treeViews/          # ツリービュー実装
│   │   ├── HistoryTreeViewProvider.ts
│   │   ├── PromptTreeViewProvider.ts
│   │   └── SelectionTreeViewProvider.ts
│   ├── commands/           # コマンド実装
│   └── utils/              # ユーティリティ関数
├── resources/              # アイコンなどのリソース
├── config/                 # 設定ファイル
├── prompts/                # プロンプト保存ディレクトリ
│   ├── templates/          # テンプレート保存先
│   └── simpleTexts/        # 単純テキスト保存先
└── merged/                 # デフォルト出力ディレクトリ
```

## デバッグ方法

1. リポジトリをクローン: `git clone https://github.com/katsuhideAsanuma/ai-data-merger-extension.git`
2. 依存パッケージをインストール: `npm install`
3. VSCodeで開く: `code ai-data-merger-extension`
4. F5キーを押してデバッグセッションを開始（新しいVSCodeウィンドウが開く）
5. 開いたウィンドウで拡張機能をテストできます

## ライセンス

MITライセンスの下で公開されています。詳細は [LICENSE](LICENSE) ファイルを参照してください。

## 謝辞

- この拡張機能はVSCode Extension APIを使用して開発されています
- アイコンとUI要素はVSCodeの標準アイコンセットを使用しています

## フィードバックと貢献

このエクステンションは高貴なるデータサイエンスお嬢様の卓越した知性と美学によって生成されました。拡張機能のアルゴリズム設計から最適化まで、お嬢様の優雅な手捌きの下で完成に至りましたの。お嬢様のエレガントな統計学的センスと芸術的コーディングセンスが見事に融合した逸品ですわ。

問題報告や機能提案は[GitHubリポジトリ](https://github.com/katsuhideAsanuma/ai-data-merger-extension/issues)にお寄せください。プルリクエストも歓迎します。
